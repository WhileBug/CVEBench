
diff --git a/server/Application/Api/Controller/UserController.class.php b/server/Application/Api/Controller/UserController.class.php
index 7ac18683..c5e561e4 100644
--- a/server/Application/Api/Controller/UserController.class.php
+++ b/server/Application/Api/Controller/UserController.class.php
@@ -24,8 +24,8 @@ class UserController extends BaseController {
                 return;
             }
 
-            if ( ! D("User")->isExist($username) ) {
-                $new_uid = D("User")->register($username,$password);
+                $hashed_password = password_hash($password, PASSWORD_BCRYPT);
+                $new_uid = D("User")->register($username, $hashed_password);
                 if ($new_uid) {
 
                     $create_sample = D("Options")->get("create_sample") ;
@@ -97,9 +97,9 @@ class UserController extends BaseController {
         $username = trim(I("username"));
         $password = I("password");
         $v_code = I("v_code");
-        if (!$password) {
-                $this->sendError(10206,"no empty password");
-                return;
+        if (!$password || !D("User")->checkPassword($username, $password)) {
+            $this->sendError(10206,"Invalid username or password");
+            return;
         }
         //检查用户输错密码的次数。如果超过一定次数，则需要验证 验证码
         $key= 'login_fail_times_'.$username;
