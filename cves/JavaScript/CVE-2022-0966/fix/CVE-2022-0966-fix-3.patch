
diff --git a/server/Application/Api/Model/AttachmentModel.class.php b/server/Application/Api/Model/AttachmentModel.class.php
index 965db2e6..45f70217 100644
--- a/server/Application/Api/Model/AttachmentModel.class.php
+++ b/server/Application/Api/Model/AttachmentModel.class.php
@@ -321,23 +321,32 @@ class AttachmentModel extends BaseModel {
 	}
 
 	// 判断上传的文件扩展名是否处于白名单内
-	public function isAllowedFilename($filename){
-		$allow_array = array(
-			'.jpg','.jpeg','.png','.bmp','.gif','.ico','.webp',
-			'.mp3','.wav','.mp4',
-			'.mov','.webmv','.flac','.mkv',
-			'.zip','.tar','.gz','.tgz','.ipa','.apk','.rar','.iso',
-			'.pdf','.ofd','.swf','.epub','.xps',
-			'.doc','.docx','.wps',
-			'.ppt','.pptx','.xls','.xlsx','.txt','.psd','.csv',
-			'.cer','.ppt','.pub','.json','.css',
-			) ;
-
-		$ext = strtolower(substr($filename,strripos($filename,'.')) ); //获取文件扩展名（转为小写后）
-		if(in_array( $ext , $allow_array ) ){
-			return true ;
-		}
-		return false;
+public function isAllowedFilename($filename){
+    $allow_array = array(
+        '.jpg','.jpeg','.png','.bmp','.gif','.ico','.webp',
+        '.mp3','.wav','.mp4',
+        '.mov','.webmv','.flac','.mkv',
+        '.zip','.tar','.gz','.tgz','.ipa','.apk','.rar','.iso',
+        '.pdf','.ofd','.swf','.epub','.xps',
+        '.doc','.docx','.wps',
+        '.ppt','.pptx','.xls','.xlsx','.txt','.psd','.csv',
+        '.cer','.ppt','.pub','.json','.css',
+    );
+
+    // Ensure only the last extension is considered
+    $filename_parts = explode('.', $filename);
+    $ext = '.' . strtolower(end($filename_parts));
+
+    // Additional security: Check for dangerous patterns or characters
+    if (preg_match('/(\.php[0-9]?|\.phtml|\.phps|\.asp|\.aspx|\.shtml|\.jsp|\.jspa|\.msi|\.exe|\.pl|\.py|\.cgi|\.cmd|\.bat|\.pif|\.scr|\.com|\.vb|\.vbs|\.js|\.reg|\.asis|\.htaccess|\.sh|\.bash|\.bsh|\.csh|\.bash_profile|\.bashrc|\.profile|\<|\>|\*|\?|\&|\||\`|\$|\%|\#|\[|\]|\{|\})/i', $filename)) {
+        return false;
+    }
+
+    if(in_array($ext, $allow_array)){
+        return true;
+    }
+    return false;
+}
 	}
 
 }
