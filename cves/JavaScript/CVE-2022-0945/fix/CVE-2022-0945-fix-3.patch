
diff --git a/server/Application/Api/Model/AttachmentModel.class.php b/server/Application/Api/Model/AttachmentModel.class.php
index 3a41ecd9..dde975ea 100644
--- a/server/Application/Api/Model/AttachmentModel.class.php
+++ b/server/Application/Api/Model/AttachmentModel.class.php
@@ -288,33 +288,29 @@ class AttachmentModel extends BaseModel {
 	}
 
 	// 判断文件名是否包含危险的扩展名
-	public function isDangerFilename($filename){
-
-		$isDangerStr = function ($filename , $keyword){
-			if(strstr(strip_tags(strtolower( $filename )), $keyword) ){
-				return true ;
-			}
-			return false;
-		};
-		if (
-			 $isDangerStr($filename , ".php")
-			|| $isDangerStr($filename , ".svg")
-			|| $isDangerStr($filename , ".htm")
-			|| $isDangerStr($filename , ".shtm")
-			|| $isDangerStr($filename , "%")
-			|| $isDangerStr($filename , ".xml")
-			|| $isDangerStr($filename , ".xxhtml")
-			|| $isDangerStr($filename , ".asp")			
-			|| $isDangerStr($filename , ".xsl")
-			|| $isDangerStr($filename , ".aspx")
-			|| $isDangerStr($filename , ".xsd")
-			|| $isDangerStr($filename , ".asa")
-		) {
-			return true;
-		}
-	
-		return false;
-	}
+public function isDangerFilename($filename){
+    $filename = strtolower($filename);  // Normalize the filename to lower case
+    $dangerous_extensions = [
+        ".php", ".php3", ".php4", ".php5", ".phtml", ".exe", ".svg", ".htm", ".html", ".shtml", ".xhtml", ".jhtml",
+        ".asp", ".aspx", ".asa", ".asax", ".ascx", ".ashx", ".asmx", ".cer", ".swf", ".xap", ".xml", ".xsl", ".xsd"
+    ];
+
+    // Check for dangerous extensions and double extensions
+    foreach ($dangerous_extensions as $ext) {
+        if (strpos($filename, $ext) !== false) {
+            if (preg_match('/\.[a-z0-9]+$/i', $filename) === 1) {  // Check if there's another extension after the dangerous one
+                return true;
+            }
+        }
+    }
+
+    // Check for encoded characters that could be used to obfuscate extensions
+    if (preg_match('/%[0-9a-f]{2}/i', $filename)) {
+        return true;
+    }
+
+    return false;
+}
 
 
 
diff --git a/test_isDangerFilename.php b/test_isDangerFilename.php
new file mode 100644
index 00000000..0a938b73
--- /dev/null
+++ b/test_isDangerFilename.php
@@ -0,0 +1,22 @@
+<?php
+require_once 'server/Application/Api/Model/AttachmentModel.class.php';
+
+$attachmentModel = new Api\Model\AttachmentModel();
+
+// Test cases
+$test_filenames = [
+    "safe_file.txt",
+    "dangerous.php",
+    "image.jpg.php",
+    "script.asp",
+    "encoded%20file.html",
+    "double_extension.html.js",
+    "safe_file.svg",
+    "malicious.xsl"
+];
+
+foreach ($test_filenames as $filename) {
+    $result = $attachmentModel->isDangerFilename($filename) ? "Dangerous" : "Safe";
+    echo "Filename: $filename is $result\n";
+}
+?>
