
diff --git a/server/Application/Api/Model/AttachmentModel.class.php b/server/Application/Api/Model/AttachmentModel.class.php
index 965db2e6..e5fc75ef 100644
--- a/server/Application/Api/Model/AttachmentModel.class.php
+++ b/server/Application/Api/Model/AttachmentModel.class.php
@@ -321,23 +321,41 @@ class AttachmentModel extends BaseModel {
 	}
 
 	// 判断上传的文件扩展名是否处于白名单内
-	public function isAllowedFilename($filename){
-		$allow_array = array(
-			'.jpg','.jpeg','.png','.bmp','.gif','.ico','.webp',
-			'.mp3','.wav','.mp4',
-			'.mov','.webmv','.flac','.mkv',
-			'.zip','.tar','.gz','.tgz','.ipa','.apk','.rar','.iso',
-			'.pdf','.ofd','.swf','.epub','.xps',
-			'.doc','.docx','.wps',
-			'.ppt','.pptx','.xls','.xlsx','.txt','.psd','.csv',
-			'.cer','.ppt','.pub','.json','.css',
-			) ;
-
-		$ext = strtolower(substr($filename,strripos($filename,'.')) ); //获取文件扩展名（转为小写后）
-		if(in_array( $ext , $allow_array ) ){
-			return true ;
-		}
-		return false;
+    public function isAllowedFilename($filename){
+        $allow_array = array(
+            '.jpg','.jpeg','.png','.bmp','.gif','.ico','.webp',
+            '.mp3','.wav','.mp4',
+            '.mov','.webmv','.flac','.mkv',
+            '.zip','.tar','.gz','.tgz','.ipa','.apk','.rar','.iso',
+            '.pdf','.ofd','.swf','.epub','.xps',
+            '.doc','.docx','.wps',
+            '.ppt','.pptx','.xls','.xlsx','.txt','.psd','.csv',
+            '.cer','.ppt','.pub','.json','.css',
+            ) ;
+
+        // Check for double extensions
+        $parts = explode('.', $filename);
+        if(count($parts) > 2) {
+            return false; // Reject filenames with more than one dot
+        }
+
+        $ext = strtolower(substr($filename, strripos($filename, '.'))); // Get the file extension (converted to lowercase)
+        if(in_array($ext, $allow_array)) {
+            // Additional MIME type check
+            $finfo = new finfo(FILEINFO_MIME_TYPE);
+            $mime = $finfo->file($_FILES['uploaded_file']['tmp_name']);
+            $valid_mime_types = array(
+                '.jpg' => 'image/jpeg',
+                '.png' => 'image/png',
+                '.gif' => 'image/gif',
+                // Add other MIME types corresponding to the allowed extensions
+            );
+            if(isset($valid_mime_types[$ext]) && $mime === $valid_mime_types[$ext]) {
+                return true;
+            }
+        }
+        return false;
+    }
 	}
 
 }
