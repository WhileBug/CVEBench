
diff --git a/src/routes/api/files.js b/src/routes/api/files.js
index 3aa2d51b6..589a2a988 100644
--- a/src/routes/api/files.js
+++ b/src/routes/api/files.js
@@ -58,7 +58,7 @@ function downloadNoteFile(noteId, res, contentDisposition = true) {
     if (contentDisposition) {
         const filename = getFilename(note);
 
-        res.setHeader('Content-Disposition', utils.getContentDisposition(filename));
+        res.setHeader('Content-Disposition', utils.getContentDisposition(utils.sanitize(filename)));
     }
 
     res.setHeader("Cache-Control", "no-cache, no-store, must-revalidate");
diff --git a/src/services/auth.js b/src/services/auth.js
index 3b36fa51c..1def44adb 100644
--- a/src/services/auth.js
+++ b/src/services/auth.js
@@ -86,7 +86,7 @@ function checkEtapiToken(req, res, next) {
 }
 
 function reject(req, res, message) {
-    log.info(`${req.method} ${req.path} rejected with 401 ${message}`);
+    log.info(`${req.method} ${req.path} rejected with 401 ${sanitize(message)}`);
 
     res.status(401).send(message);
 }
@@ -104,12 +104,15 @@ function checkCredentials(req, res, next) {
 
     const header = req.headers['trilium-cred'] || '';
     const auth = new Buffer.from(header, 'base64').toString();
-    const [username, password] = auth.split(/:/);
-
-    // username is ignored
+    if (!username || !password) {
+        res.status(400).send('Username or password not provided.');
+        return;
+    }
 
     if (!passwordEncryptionService.verifyPassword(password)) {
         res.status(401).send('Incorrect password');
+    } else {
+        next();
     }
     else {
         next();
diff --git a/src/share/routes.js b/src/share/routes.js
index ce858ad6b..995862cd0 100644
--- a/src/share/routes.js
+++ b/src/share/routes.js
@@ -41,7 +41,7 @@ function register(router) {
         if (note.hasLabel('shareRaw') || ['image', 'file'].includes(note.type)) {
             res.setHeader('Content-Type', note.mime);
 
-            res.send(note.getContent());
+            res.send(escapeHtml(note.getContent()));
             return;
         }
 
