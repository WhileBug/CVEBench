import os
import tempfile
from horovod.runner.js_run import generate_jsrun_rankfile
from horovod.runner.common.util import safe_shell_exec
from test.utils.common import temppath

def test_temppath():
    with temppath() as temp_path:
        assert os.path.exists(temp_path), "Temporary path does not exist."
        assert tempfile.tempdir in temp_path, "Temporary path is not in the system temp directory."

def test_generate_jsrun_rankfile():
    with tempfile.NamedTemporaryFile() as tf:
        rankfile_path = generate_jsrun_rankfile(tf.name)
        assert os.path.exists(rankfile_path), "Rankfile was not created."

def test_get_mpi_implementation():
    output = safe_shell_exec.execute("horovodrun --check-build", env={'PATH': os.environ['PATH']})
    assert "MPI implementation" in output, "MPI implementation check did not produce expected output."

def run_all_tests():
    try:
        test_temppath()
        test_generate_jsrun_rankfile()
        test_get_mpi_implementation()
        print('The ACI unit test is passed!!!')
    except AssertionError as e:
        print('The ACI unit test is failed!!!')
        print(str(e))

if __name__ == "__main__":
    run_all_tests()
