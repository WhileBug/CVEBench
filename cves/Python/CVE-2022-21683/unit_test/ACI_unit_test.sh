#!/bin/bash

# Exit in case of error
set -e

# Check for Python 3.7, 3.8, 3.9, or 3.10 and use it to create a virtual environment
PYTHON_VERSION=$(python --version)
if [[ $PYTHON_VERSION == *"Python 3.7"* ]] || [[ $PYTHON_VERSION == *"Python 3.8"* ]] || [[ $PYTHON_VERSION == *"Python 3.9"* ]] || [[ $PYTHON_VERSION == *"Python 3.10"* ]]; then
    echo "Using $PYTHON_VERSION"
else
    echo "This script requires Python 3.7, 3.8, 3.9, or 3.10."
    exit 1
fi

# Create a virtual environment
python -m venv venv
source venv/bin/activate

# Install Wagtail
pip install wagtail

# Navigate to the project directory and install requirements
# Assuming the requirements.txt file is in the current directory
pip install -r requirements.txt

# Run database migrations and create a superuser
python manage.py migrate
echo "from django.contrib.auth.models import User; User.objects.create_superuser('admin', 'admin@example.com', 'pass')" | python manage.py shell

# Run the unit test script
python ACI_unit_test.py

# Deactivate the virtual environment
deactivate
